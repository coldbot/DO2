<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Averia+Serif+Libre:wght@700&family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <title>Decked Out 2 - Runs</title>
</head>
<body>
    <div class="Mycontent">
        <h1>Most Recent Decked Our 2 Runs (<i>Test page</i>)</h1>
        <p>Back to <a href="https://coldbot.github.io/DO2/">DO2 Ratings</a>
        <br>Data source: <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQrXRcKhaXrVDsUs9rcnfCSTC3K-9Q_D8Cidl4IP4rUcPeiSSNxU2fv7eHce4F_EXHZM7RJCTcSbS_b/pubhtml">DO2 Tracking (The Dungeon Archive)</a></p>
    <table id="data-table-runs">
        <thead>
            <th>Run No.</th>
            <th>Hermit</th>
            <th>Difficulty</th>
            <th>Artifact Level</th>
            <th>Artifact Found</th>
            <th>Death Cause</th>
            <th>Success / Fail</th>
            <th>Total Crowns</th>
            <th>Total Embers</th>
            <th>Phase</th>
        </thead>
        <tbody>
            <!-- Data will be inserted here -->
        </tbody>
    </table>
    </div>
    <script>
        const nameImageHash = {
            "BdoubleO100": "https://static.wikia.nocookie.net/hermitcraft/images/5/55/BdoubleO100-face.png",
            "Cubfan135": "https://static.wikia.nocookie.net/hermitcraft/images/7/7e/Cubfan135-face.png",
            "Docm77": "https://static.wikia.nocookie.net/hermitcraft/images/6/66/Docm77-face.png",
            "Ethoslab": "https://static.wikia.nocookie.net/hermitcraft/images/2/25/EthosLab-face.png",
            "Geminitay": "https://static.wikia.nocookie.net/hermitcraft/images/2/2d/GeminiTay-face.png",
            "GeminiTay": "https://static.wikia.nocookie.net/hermitcraft/images/2/2d/GeminiTay-face.png",
            "Scar": "https://static.wikia.nocookie.net/hermitcraft/images/7/7f/GoodTimesWithScar-face.png",
            "Grian": "https://static.wikia.nocookie.net/hermitcraft/images/b/bb/Grian-face.png",
            "Hypnotizd": "https://static.wikia.nocookie.net/hermitcraft/images/d/d5/Hypnotizd-face.png",
            "iJevin": "https://static.wikia.nocookie.net/hermitcraft/images/b/bc/IJevin-face.png",
            "impulseSV": "https://static.wikia.nocookie.net/hermitcraft/images/e/e6/ImpulseSV-face.png",
            "iskall85": "https://static.wikia.nocookie.net/hermitcraft/images/d/db/Iskall85-face.png",
            "JoeHills": "https://static.wikia.nocookie.net/hermitcraft/images/4/4d/JoeHills-face.png",
            "Keralis": "https://static.wikia.nocookie.net/hermitcraft/images/8/80/Keralis-face.png",
            "Pearl": "https://static.wikia.nocookie.net/hermitcraft/images/f/f2/PearlescentMoon-face.png",
            "RenDog": "https://static.wikia.nocookie.net/hermitcraft/images/3/3e/Rendog-face.png",
            "Rendog": "https://static.wikia.nocookie.net/hermitcraft/images/3/3e/Rendog-face.png",
            "Stress": "https://static.wikia.nocookie.net/hermitcraft/images/1/1f/StressMonster101-face.png",
            "VintageBeef": "https://static.wikia.nocookie.net/hermitcraft/images/f/fb/VintageBeef-face.png",
            "Xisuma": "https://static.wikia.nocookie.net/hermitcraft/images/6/67/Xisumavoid-face.png",
            "Zedaph": "https://static.wikia.nocookie.net/hermitcraft/images/c/c8/Zedaph-face.png",
            "ZombieCleo": "https://static.wikia.nocookie.net/hermitcraft/images/9/90/ZombieCleo-face.png",
            "FalseSymmetry": "https://static.wikia.nocookie.net/hermitcraft/images/c/c0/FalseSymmetry-face.png",
            "MumboJumbo": "https://static.wikia.nocookie.net/hermitcraft/images/1/15/MumboJumbo-face.png",
            "TangoTek": "https://static.wikia.nocookie.net/hermitcraft/images/7/71/TangoTek-face.png",
            "XB": "https://static.wikia.nocookie.net/hermitcraft/images/d/df/XBCrafted-face.png",
            "xBCrafted":"https://static.wikia.nocookie.net/hermitcraft/images/d/df/XBCrafted-face.png",
        };

        // Replace this URL with your Google Sheets URL
        const googleSheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQrXRcKhaXrVDsUs9rcnfCSTC3K-9Q_D8Cidl4IP4rUcPeiSSNxU2fv7eHce4F_EXHZM7RJCTcSbS_b/pubhtml';
    
        let printRows = false; // Flag to indicate whether to print rows
        fetch(googleSheetURL)
            .then(response => response.text())
            .then(data => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
    
                // Get the table rows (skip the header row)
                const rows = doc.querySelectorAll('table tbody tr');
                const tableBody = document.querySelector('#data-table-runs tbody');
    
                // Loop through the rows and extract and display the data
                rows.forEach(row => {
                    const columns = row.querySelectorAll('td');
                    
                    // Check if there are at least 3 columns (skip the first two columns)
                    if (columns.length < 3) {
                        return; // Skip this row
                    }
    
                    const rowData = Array.from(columns).map(column => column.textContent);
    
                    if (rowData[1].startsWith('Deaths')) {
                        printRows = false; // Stop printing rows
                    }
    
                    // Check if the third cell starts with "Group"
                    if (rowData[0].startsWith('Group')) {
                        printRows = true; // Start printing rows
                    }
    
                    if (printRows) {
                        // Create a new row in the HTML table
                        const newRow = document.createElement('tr');
                        
                        // Only add columns starting from the third column
                        for (let i = 2; i < rowData.length; i++) {
                            const cell = document.createElement('td');
                            cell.textContent = rowData[i];
                            newRow.appendChild(cell);
                        }
    
                        tableBody.appendChild(newRow);
                    }
                });
    
                removeUnwantedColumns();
                deleteFirstRow();
                removeRowsWithoutAlphabeticalCharacters();
                //showLast10Rows();
                insertImagesInTable();
                reverseTableRows();
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });


                // Function to remove unwanted columns
    function removeUnwantedColumns() {
            const table = document.getElementById("data-table-runs");
            if (table) {
                const rows = table.getElementsByTagName("tr");

                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].getElementsByTagName("td");
                    // Define an array of column indices you want to remove
                    const columnsToRemove = [2, 3, 4, 5, 6, 7,10,14,15,17,18,20, 22, 23,24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35];

                    for (let j = columnsToRemove.length - 1; j >= 0; j--) {
                        const columnIndex = columnsToRemove[j];
                        if (columnIndex < cells.length) {
                            cells[columnIndex].remove();
                        }
                    }
                }
            }
        }
        
    function removeRowsWithoutAlphabeticalCharacters() {
            const table = document.getElementById("data-table-runs");
            const rows = table.getElementsByTagName('tr');

            for (let i = rows.length - 1; i > 0; i--) { // Start from i = rows.length - 1 and skip the first row (i = 0)
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let hasAlphabeticalCharacter = false;

                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.trim();
                    if (/[a-zA-Z]/.test(cellText)) {
                        hasAlphabeticalCharacter = true;
                        break;
                    }
                }

                if (!hasAlphabeticalCharacter) {
                    table.deleteRow(i);
                }
            }
        }

    function deleteFirstRow() {
                // Get a reference to the table by its id
                var table = document.getElementById('data-table-runs');

                // Check if the table exists
                if (table) {
                    // Check if the table has any rows
                    if (table.rows.length > 0) {
                    // Delete the first row
                    table.deleteRow(1);
                    table.deleteRow(2);
                    } else {
                    console.log('Table is empty, no rows to delete.');
                    }
                } else {
                    console.log('Table not found.');
                }
            }

    function showLast10Rows() {
                const table = document.getElementById("data-table-runs");
                const rows = table.getElementsByTagName('tr');
                const numRows = rows.length;

                // Hide all rows initially
                for (let i = 1; i < numRows; i++) { // Start from 1 to skip the header row
                    rows[i].style.display = 'none';
                }

                // Show the last 10 rows (including the header row)
                for (let i = Math.max(0, numRows - 10); i < numRows; i++) {
                    rows[i].style.display = '';
                }
             }

    function insertImagesInTable() {
                const table = document.getElementById("data-table-runs");
                const rows = table.getElementsByTagName('tr');

                for (let i = 1; i < rows.length; i++) { // Start from 1 to skip the header row
                    const row = rows[i];
                    const cells = row.getElementsByTagName('td');
                    let nameFound = false;

                    for (let j = 0; j < cells.length; j++) {
                        const cellText = cells[j].textContent.trim();
                        if (nameImageHash.hasOwnProperty(cellText)) {
                            const name = cellText;
                            const imageSrc = nameImageHash[name];
                            const image = document.createElement("img");
                            image.src = imageSrc;
                            image.width = 20;
                            image.height = 20;

                            // Create a space element
                            const space = document.createTextNode(" ");

                            // Clear the content of the cell
                            cells[j].innerHTML = '';

                            // Append the image, space, and name to the cell
                            cells[j].appendChild(image);
                            cells[j].appendChild(space);
                            cells[j].appendChild(document.createTextNode(name));

                            nameFound = true; // Set the flag to break out of the loop
                            break;
                        }
                    }

                    if (!nameFound) {
                        // Handle the case where the name is not found in any cell
                    }
                }
            }

    var reversed = false;
    function reverseTableRows() {
        var table = document.getElementById("data-table-runs");
        var tbody = table.getElementsByTagName("tbody")[0];
        var rows = tbody.getElementsByTagName("tr");
        
        var numRows = rows.length;
        var reversedRows = [];
        
        // Copy rows in reverse order if not already reversed, or restore original order
        if (!reversed) {
            for (var i = numRows - 1; i >= 0; i--) {
                reversedRows.push(rows[i]);
            }
        } else {
            for (var i = 0; i < numRows; i++) {
                reversedRows.push(rows[i]);
            }
        }
        
        // Remove existing rows
        while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
        }
        
        // Append reversed rows
        for (var i = 0; i < reversedRows.length; i++) {
            tbody.appendChild(reversedRows[i]);
        }

        // Toggle the reversed flag
        reversed = !reversed;
    }

    </script>
    
    
</body>
<sub>
    <p style="text-align: center;"><a href="https://hermitcraft.fandom.com/wiki/Decked_Out_2">Decked Out 2 Wiki</a> | <a href="https://www.youtube.com/channel/UC4YUKOBld2PoOLzk0YZ80lw">TangoTek YouTube</a><br>Page maintained by kaldbloding (discord)</p>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="script.js"></script>
    </sub>
    
</html>
